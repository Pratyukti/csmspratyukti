import{h as ne,r as d,j as e,D as R}from"./index-BmhtVPv5.js";import{R as se,a as N,T as oe}from"./Training2-COGEeZTe.js";import{T as le,I as de}from"./Training4-bhIEWpzT.js";import{C as ce}from"./Container-IzyfE8TG.js";import{B as he}from"./Box-B7wMBWR0.js";import{C as me,a as ue,D as ge}from"./CardContent-Bjynev8U.js";import{G as c}from"./Grid-BtRfdkOb.js";import{T as j,F as z}from"./TextField-CCACKWvT.js";import{B as U}from"./Button-DjyydPIF.js";import{T as x}from"./IconButton-Tk6TJOMm.js";import{F as q}from"./FormControlLabel-DVJZlbZW.js";import"./createSvgIcon-BV0hWzIg.js";import"./TableRow-BgRVcAap.js";import"./styled-Es8HYhS7.js";import"./dividerClasses-BkLoX1rB.js";const Ne=()=>{const F=ne(i=>i.userInfo),[_,W]=d.useState(F.whitelevel_id),[O,v]=d.useState(new Date().toISOString().split("T")[0]),[T,k]=d.useState(""),[m,b]=d.useState("4"),[y,w]=d.useState(""),[V,A]=d.useState(!1),[p,S]=d.useState([]),[f,I]=d.useState([]),[C,D]=d.useState(""),[P,u]=d.useState(!1),[B,E]=d.useState("");d.useState({option1:!1});const[s,g]=d.useState({trainingDate:"",trainingId:"",whitelevelId:"",trainingType:"",trainingName:"",trainers:"",trainees:"",image:"",about_the_training:""}),[G,Z]=d.useState(!1),$=(i,a)=>{const r=i.map(o=>o.trainer_id),l=a.map(o=>o.trainee_id);return r.filter(o=>l.includes(o)).length>0},H=async i=>{var a,r;if(i.target,!!T){u(!0),u(!0);try{const l=await R.post("/training/training-details/",{training_id:T,whitelevel_id:_}),n=l.data;n?(v(n.training_date),b(n.training_type),w(n.training_name),S((a=n==null?void 0:n.trainers)==null?void 0:a.map(o=>({employee_id:o.employee_id||"0",employee_name:o.trainer_name||"others"}))),I((r=n==null?void 0:n.trainees)==null?void 0:r.map(o=>({employee_id:o.employee_id,employee_name:o.trainee_name}))),D(n.training_image),E(n.about_the_training)):alert("No SafetyTraining data found. Please check the reference number."),console.log("Fetched data:",l.data)}catch(l){console.error("Error fetching accident data:",l),g({fetch:"Failed to fetch accident data. Please try again."})}finally{u(!1)}}},J=(i,a)=>{let r={...s};if(i==="trainers"&&(S(a),G)){let l=[],n=!1;if(a.forEach((o,t)=>{o.trainer_id!=="0"&&(!o.trainer_id||!o.trainer_name)&&(l.push(`Trainer ${t+1} has empty fields.`),n=!0)}),n){r.trainers=l.join(" "),g(r);return}$(a,f)?(r.trainers="Trainer and Trainee employee codes should not be equal",r.trainees="Trainer and Trainee employee codes should not be equal"):(r.trainers="",r.trainees="")}if(i==="trainees"&&(I(a),G)){let l=[],n=!1;if(a.forEach((o,t)=>{o.trainee_id!=="0"&&(!o.trainee_id||!o.trainee_name)&&(l.push(`Trainee ${t+1} has empty fields.`),n=!0)}),n){r.trainees=l.join(" "),g(r);return}$(p,a)?(r.trainers="Trainer and Trainee employee codes should not be equal",r.trainees="Trainer and Trainee employee codes should not be equal"):(r.trainers="",r.trainees="")}},K=i=>{W(i.target.value)},M=i=>{v(i.target.value)},Q=i=>{const a=i.target.value;b(a),A(a==="1"),g({...s,trainingType:a===""?"Training Type is required":""})},X=i=>{const a=i.target.value,r=/^[A-Za-z\s]*$/;w(a),m==="1"&&(r.test(a)?g({...s,trainingName:""}):g({...s,trainingName:"Training Name must contain only alphabets and spaces"}))},Y=i=>{k(i.target.value)},ee=i=>{E(i.target.value)},re=new Date().toISOString().split("T")[0],te=()=>{W(F.whitelevel_id),v(new Date().toISOString().split("T")[0]),k(""),b("4"),w(""),A(!1),S([]),I([]),D(""),E("")},ie=async i=>{var n,o;i.preventDefault(),u(!0),Z(!0);let a=!0;const r={trainingDate:O?"":"Training Date is required",trainingId:T?"":"Training ID is required",whitelevelId:_?"":"Whitelevel ID is required",trainingType:m?"":"Training Type is required",trainingName:m==="1"&&!y?"Training Name is required":"",trainers:p.length===0?"At least one Trainer is required":"",trainees:f.length===0?"At least one Trainee is required":""};if(m==="1"&&(y?/^[A-Za-z\s]*$/.test(y)||(r.trainingName="Training Name must contain only alphabets and spaces",a=!1):(r.trainingName="Training Name is required",a=!1)),Object.keys(r).forEach(t=>{r[t]&&(a=!1)}),p.forEach((t,h)=>{t.trainer_id!=="0"&&(!t.trainer_id||!t.trainer_name)&&(r[`trainer_${h}_name`]="Trainer name is required",a=!1)}),f.forEach((t,h)=>{t.trainee_id!=="0"&&(!t.trainee_id||!t.trainee_name)&&(r[`trainee_${h}_name`]="Trainee name is required",a=!1)}),$(p,f)&&(r.trainers="Trainer and Trainee employee codes should not be equal",r.trainees="Trainer and Trainee employee codes should not be equal",a=!1),g(r),!a){u(!1);return}const l={training_id:T,training_date:O,whitelevel_id:_,training_type:m,training_image:C,about_the_training:B,training_name:m==="1"?y:null,trainers:p.map(({trainer_id:t,whitelevel_id:h,trainer_name:L})=>({trainer_id:t,whitelevel_id:h,trainer_name:L})),trainees:f.map(({trainee_id:t,trainee_name:h,whitelevel_id:L})=>({trainee_id:t,whitelevel_id:L,trainee_name:h}))};console.log("Submitting the following data:"),console.log(JSON.stringify(l,null,2));try{const t=await R.post("/training/start/",l);console.log("Success:",t.data),window.alert("Safety Training Form submitted successfully!"),te(),W(F.whitelevel_id),v(new Date().toISOString().split("T")[0]),k(""),b("4"),w(""),A(!1),S([]),I([]),D(""),E("")}catch(t){if(t.response){console.error(`HTTP error! Status: ${t.response.status}`);const h=JSON.stringify(t.response.data);console.error("Response body:",h),((o=(n=t.response.data)==null?void 0:n.training_id)==null?void 0:o[0])==="training with this training id already exists."?window.alert("Training ID already exists. Please use a different ID."):window.alert("Error submitting form. Please check the details and try again.")}else t.isAxiosError?(console.error("Axios error:",t.message),window.alert("An error occurred with the request. Please try again.")):t.name==="TypeError"?(console.error("Network error: Please check if the server is running and accessible."),window.alert("Network error: Please check if the server is running and accessible.")):(console.error("Error fetching data:",t.message),window.alert(`Error fetching data: ${t.message}`))}finally{u(!1)}},ae=async i=>{i.preventDefault(),u(!0);const a={training_id:T,training_type:m,training_name:y,whitelevel_id:_,image:C,about_the_training:B,training_image:C,trainers:p.map(({trainer_id:r,whitelevel_id:l,trainer_name:n})=>({employee_id:r,whitelevel_id:l,trainer_name:n})),trainees:f.map(({trainee_id:r,trainee_name:l,whitelevel_id:n})=>({employee_id:r,whitelevel_id:n,trainee_name:l}))};try{const r=await R.put("/training/training-details-update/",a);console.log("Updated Training:",r.data),alert("Updated Training:",r.data)}catch(r){console.error("Error:",r),g("An error occurred while updating the accident.")}finally{u(!1)}};return e.jsx(ce,{children:e.jsx(he,{className:"section",sx:{display:"flex",justifyContent:"center",padding:4},children:e.jsx("form",{onSubmit:ie,children:e.jsx(me,{sx:{maxwidth:"100%",padding:3,boxShadow:3},children:e.jsx(ue,{children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,sm:5.5,children:e.jsx(j,{label:"Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},inputProps:{max:new Date().toISOString().split("T")[0]},value:O,onChange:M,max:re,error:!!s.trainingDate,helperText:s.trainingDate,required:!0})}),e.jsx(c,{item:!0,xs:12,sm:5.5,children:e.jsx(j,{label:"Reference Number",fullWidth:!0,value:T,onChange:Y,error:!!s.trainingId,helperText:s.trainingId})}),e.jsx(c,{item:!0,xs:12,sm:1,sx:{marginTop:"10px"},children:e.jsx(U,{variant:"contained",color:"secondary",onClick:H,fullWidth:!0,disabled:P,children:"ok"})}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(x,{variant:"h6",style:{display:"none"},children:"Whitelevel ID:"}),e.jsx(z,{fullWidth:!0,margin:"normal",style:{display:"none"},children:e.jsx(j,{style:{display:"none"},label:"Whitelevel ID",fullWidth:!0,value:_,onChange:K,error:!!s.whitelevelId,helperText:s.whitelevelId})})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(x,{variant:"h6",sx:{marginBottom:1},required:!0,children:"Training Type *:"}),e.jsxs(se,{row:!0,value:m,onChange:Q,children:[e.jsx(q,{value:"4",control:e.jsx(N,{}),label:"Tool box Training"}),e.jsx(q,{value:"3",control:e.jsx(N,{}),label:"Job & Safety"}),e.jsx(q,{value:"2",control:e.jsx(N,{}),label:"Behavioural"}),e.jsx(q,{value:"1",control:e.jsx(N,{}),label:"Others"})]}),V&&e.jsx(j,{label:"Name of Training",fullWidth:!0,value:y,onChange:X,error:!!s.trainingName,helperText:s.trainingName}),s.trainingType&&e.jsx(x,{variant:"body2",color:"error",sx:{mt:1},children:s.trainingType})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(ge,{sx:{marginBottom:3}}),e.jsx(x,{variant:"h6",children:"TRAINER *: (Enter 0 in case of Others)"}),e.jsx(oe,{onEmployeesChange:i=>J("trainers",i),error:!!s.trainers,helperText:s.trainers,initialData:p}),s.trainers&&e.jsx(x,{variant:"body2",color:"error",sx:{mt:1},children:s.trainers})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(x,{variant:"h6",children:"TRAINEE *:"}),e.jsx(le,{onChange:i=>J("trainees",i),error:!!s.trainees,helperText:s.trainees,initialData:f}),s.trainees&&e.jsx(x,{variant:"body2",color:"error",sx:{mt:1},children:s.trainees})]}),e.jsx(c,{item:!0,xs:12,children:e.jsx(z,{fullWidth:!0,margin:"normal",children:e.jsx(j,{label:"Description",multiline:!0,rows:4,value:B,onChange:ee})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(de,{setCompressedImageBase64:D,compressedImageBase64:C})}),e.jsxs(c,{container:!0,spacing:2,sx:{marginTop:"20px"},children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(U,{variant:"contained",color:"primary",type:"submit",fullWidth:!0,disabled:P,children:"Submit"})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(U,{variant:"contained",color:"secondary",onClick:ae,fullWidth:!0,disabled:P,children:"Update"})})]})]})})})})})})};export{Ne as default};
