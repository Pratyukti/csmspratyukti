import{h as oe,r as l,j as r,D as R}from"./index-Boe2fyA3.js";import{R as le,a as N,T as V}from"./Training2-BN_aXgWc.js";import{T as Z,I as de}from"./Training4-CPFpNFko.js";import{C as ce}from"./Container-DPpFuXe7.js";import{B as he}from"./Box-C0X5J2nK.js";import{C as me,a as ue,D as ge}from"./CardContent-DR3QyUyU.js";import{G as c}from"./Grid-FZaXOIhF.js";import{T as b,F as z}from"./TextField-BzL9MfDW.js";import{B as U}from"./Button-B8Ap5Nqt.js";import{T as x}from"./IconButton-DQGqpul0.js";import{F as q}from"./FormControlLabel-CiMbPHO2.js";import"./createSvgIcon-BR_Pr42U.js";import"./TableRow-CNe_rHPg.js";import"./styled-Be183tax.js";import"./dividerClasses-DpB7HgcG.js";const Ne=()=>{const F=oe(i=>i.userInfo),[_,W]=l.useState(F.whitelevel_id),[O,w]=l.useState(new Date().toISOString().split("T")[0]),[T,k]=l.useState(""),[m,S]=l.useState("4"),[y,I]=l.useState(""),[H,A]=l.useState(!1),[u,j]=l.useState([]),[g,v]=l.useState([]),[C,D]=l.useState(""),[P,p]=l.useState(!1),[B,E]=l.useState("");l.useState({option1:!1});const[s,f]=l.useState({trainingDate:"",trainingId:"",whitelevelId:"",trainingType:"",trainingName:"",trainers:"",trainees:"",image:"",about_the_training:""}),[G,K]=l.useState(!1),$=(i,t)=>{const e=i.map(o=>o.trainer_id),n=t.map(o=>o.trainee_id);return e.filter(o=>n.includes(o)).length>0},M=async i=>{if(i.target,!!T){p(!0),p(!0);try{const t=await R.post("/training/training-details/",{training_id:T,whitelevel_id:_}),e=t.data;e?(w(e.training_date),S(e.training_type),I(e.training_name),j(e.trainers||[]),v(e.trainees||[]),j(e.trainers.map(n=>({employee_id:(n==null?void 0:n.employee_id)||"0",employee_name:(n==null?void 0:n.trainer_name)||"others"}))),console.log("Trainers fetched and processed:",e.trainers),v(e.trainees.map(n=>({employee_id:(n==null?void 0:n.employee_id)||"0",employee_name:(n==null?void 0:n.trainee_name)||"others"}))),console.log("Trainees fetched and processed:",e.trainees),D(e.training_image),E(e.about_the_training)):alert("No SafetyTraining data found. Please check the reference number."),console.log("Fetched data:",t.data)}catch(t){console.error("Error fetching accident data:",t),f({fetch:"Failed to fetch accident data. Please try again."})}finally{p(!1)}}},J=(i,t)=>{let e={...s};if(i==="trainers"&&(j(t),G)){let n=[],d=!1;if(t.forEach((o,a)=>{o.trainer_id!=="0"&&(!o.trainer_id||!o.trainer_name)&&(n.push(`Trainer ${a+1} has empty fields.`),d=!0)}),d){e.trainers=n.join(" "),f(e);return}$(t,g)?(e.trainers="Trainer and Trainee employee codes should not be equal",e.trainees="Trainer and Trainee employee codes should not be equal"):(e.trainers="",e.trainees="")}if(i==="trainees"&&(v(t),G)){let n=[],d=!1;if(t.forEach((o,a)=>{o.trainee_id!=="0"&&(!o.trainee_id||!o.trainee_name)&&(n.push(`Trainee ${a+1} has empty fields.`),d=!0)}),d){e.trainees=n.join(" "),f(e);return}$(u,t)?(e.trainers="Trainer and Trainee employee codes should not be equal",e.trainees="Trainer and Trainee employee codes should not be equal"):(e.trainers="",e.trainees="")}},Q=i=>{W(i.target.value)},X=i=>{w(i.target.value)},Y=i=>{const t=i.target.value;S(t),A(t==="1"),f({...s,trainingType:t===""?"Training Type is required":""})},ee=i=>{const t=i.target.value,e=/^[A-Za-z\s]*$/;I(t),m==="1"&&(e.test(t)?f({...s,trainingName:""}):f({...s,trainingName:"Training Name must contain only alphabets and spaces"}))},re=i=>{k(i.target.value)},te=i=>{E(i.target.value)},ae=new Date().toISOString().split("T")[0],ie=()=>{W(F.whitelevel_id),w(new Date().toISOString().split("T")[0]),k(""),S("4"),I(""),A(!1),j([]),v([]),D(""),E("")},ne=async i=>{var d,o;i.preventDefault(),p(!0),K(!0);let t=!0;const e={trainingDate:O?"":"Training Date is required",trainingId:T?"":"Training ID is required",whitelevelId:_?"":"Whitelevel ID is required",trainingType:m?"":"Training Type is required",trainingName:m==="1"&&!y?"Training Name is required":"",trainers:u.length===0?"At least one Trainer is required":"",trainees:g.length===0?"At least one Trainee is required":""};if(m==="1"&&(y?/^[A-Za-z\s]*$/.test(y)||(e.trainingName="Training Name must contain only alphabets and spaces",t=!1):(e.trainingName="Training Name is required",t=!1)),Object.keys(e).forEach(a=>{e[a]&&(t=!1)}),u.forEach((a,h)=>{a.trainer_id!=="0"&&(!a.trainer_id||!a.trainer_name)&&(e[`trainer_${h}_name`]="Trainer name is required",t=!1)}),g.forEach((a,h)=>{a.trainee_id!=="0"&&(!a.trainee_id||!a.trainee_name)&&(e[`trainee_${h}_name`]="Trainee name is required",t=!1)}),$(u,g)&&(e.trainers="Trainer and Trainee employee codes should not be equal",e.trainees="Trainer and Trainee employee codes should not be equal",t=!1),f(e),!t){p(!1);return}const n={training_id:T,training_date:O,whitelevel_id:_,training_type:m,training_image:C,about_the_training:B,training_name:m==="1"?y:null,trainers:u.map(({trainer_id:a,whitelevel_id:h,trainer_name:L})=>({trainer_id:a,whitelevel_id:h,trainer_name:L})),trainees:g.map(({trainee_id:a,trainee_name:h,whitelevel_id:L})=>({trainee_id:a,whitelevel_id:L,trainee_name:h}))};console.log("Submitting the following data:"),console.log(JSON.stringify(n,null,2));try{const a=await R.post("/training/start/",n);console.log("Success:",a.data),window.alert("Safety Training Form submitted successfully!"),ie(),W(F.whitelevel_id),w(new Date().toISOString().split("T")[0]),k(""),S("4"),I(""),A(!1),j([]),v([]),D(""),E("")}catch(a){if(a.response){console.error(`HTTP error! Status: ${a.response.status}`);const h=JSON.stringify(a.response.data);console.error("Response body:",h),((o=(d=a.response.data)==null?void 0:d.training_id)==null?void 0:o[0])==="training with this training id already exists."?window.alert("Training ID already exists. Please use a different ID."):window.alert("Error submitting form. Please check the details and try again.")}else a.isAxiosError?(console.error("Axios error:",a.message),window.alert("An error occurred with the request. Please try again.")):a.name==="TypeError"?(console.error("Network error: Please check if the server is running and accessible."),window.alert("Network error: Please check if the server is running and accessible.")):(console.error("Error fetching data:",a.message),window.alert(`Error fetching data: ${a.message}`))}finally{p(!1)}},se=async i=>{i.preventDefault(),p(!0);const t={training_id:T,training_type:m,training_name:y,whitelevel_id:_,image:C,about_the_training:B,training_image:C,trainers:u.map(({trainer_id:e,whitelevel_id:n,trainer_name:d})=>({employee_id:e,whitelevel_id:n,trainer_name:d})),trainees:g.map(({trainee_id:e,trainee_name:n,whitelevel_id:d})=>({employee_id:e,whitelevel_id:d,trainee_name:n}))};try{const e=await R.put("/training/training-details-update/",t);console.log("Updated Training:",e.data),alert("Updated Training:",e.data)}catch(e){console.error("Error:",e),f("An error occurred while updating the accident.")}finally{p(!1)}};return r.jsx(ce,{children:r.jsx(he,{className:"section",sx:{display:"flex",justifyContent:"center",padding:4},children:r.jsx("form",{onSubmit:ne,children:r.jsx(me,{sx:{maxwidth:"100%",padding:3,boxShadow:3},children:r.jsx(ue,{children:r.jsxs(c,{container:!0,spacing:2,children:[r.jsx(c,{item:!0,xs:12,sm:5.5,children:r.jsx(b,{label:"Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},inputProps:{max:new Date().toISOString().split("T")[0]},value:O,onChange:X,max:ae,error:!!s.trainingDate,helperText:s.trainingDate,required:!0})}),r.jsx(c,{item:!0,xs:12,sm:5.5,children:r.jsx(b,{label:"Reference Number",fullWidth:!0,value:T,onChange:re,error:!!s.trainingId,helperText:s.trainingId})}),r.jsx(c,{item:!0,xs:12,sm:1,sx:{marginTop:"10px"},children:r.jsx(U,{variant:"contained",color:"secondary",onClick:M,fullWidth:!0,disabled:P,children:"ok"})}),r.jsxs(c,{item:!0,xs:12,children:[r.jsx(x,{variant:"h6",style:{display:"none"},children:"Whitelevel ID:"}),r.jsx(z,{fullWidth:!0,margin:"normal",style:{display:"none"},children:r.jsx(b,{style:{display:"none"},label:"Whitelevel ID",fullWidth:!0,value:_,onChange:Q,error:!!s.whitelevelId,helperText:s.whitelevelId})})]}),r.jsxs(c,{item:!0,xs:12,children:[r.jsx(x,{variant:"h6",sx:{marginBottom:1},required:!0,children:"Training Type *:"}),r.jsxs(le,{row:!0,value:m,onChange:Y,children:[r.jsx(q,{value:"4",control:r.jsx(N,{}),label:"Tool box Training"}),r.jsx(q,{value:"3",control:r.jsx(N,{}),label:"Job & Safety"}),r.jsx(q,{value:"2",control:r.jsx(N,{}),label:"Behavioural"}),r.jsx(q,{value:"1",control:r.jsx(N,{}),label:"Others"})]}),H&&r.jsx(b,{label:"Name of Training",fullWidth:!0,value:y,onChange:ee,error:!!s.trainingName,helperText:s.trainingName}),s.trainingType&&r.jsx(x,{variant:"body2",color:"error",sx:{mt:1},children:s.trainingType})]}),r.jsxs(c,{item:!0,xs:12,children:[r.jsx(ge,{sx:{marginBottom:3}}),r.jsx(x,{variant:"h6",children:"TRAINER *: (Enter 0 in case of Others)"}),r.jsx(V,{onEmployeesChange:i=>J("trainers",i),error:!!s.trainers,helperText:s.trainers,initialData:u.length>0?u:[]}),s.trainers&&r.jsx(x,{variant:"body2",color:"error",sx:{mt:1},children:s.trainers})]}),r.jsxs(c,{item:!0,xs:12,children:[r.jsx(x,{variant:"h6",children:"TRAINEE *:"}),r.jsx(Z,{onChange:i=>J("trainees",i),error:!!s.trainees,helperText:s.trainees,initialData:g.length>0?g:[]}),s.trainees&&r.jsx(x,{variant:"body2",color:"error",sx:{mt:1},children:s.trainees})]}),r.jsx(c,{item:!0,xs:12,children:r.jsx(z,{fullWidth:!0,margin:"normal",children:r.jsx(b,{label:"Description",multiline:!0,rows:4,value:B,onChange:te})})}),r.jsx(c,{item:!0,xs:12,children:r.jsx(de,{setCompressedImageBase64:D,compressedImageBase64:C})}),r.jsxs(c,{container:!0,spacing:2,sx:{marginTop:"20px"},children:[r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(U,{variant:"contained",color:"primary",type:"submit",fullWidth:!0,disabled:P,children:"Submit"})}),r.jsx(c,{item:!0,xs:12,md:6,children:r.jsx(U,{variant:"contained",color:"secondary",onClick:se,fullWidth:!0,disabled:P,children:"Update"})})]})]})})})})})})};l.memo(V);l.memo(Z);export{Ne as default};
