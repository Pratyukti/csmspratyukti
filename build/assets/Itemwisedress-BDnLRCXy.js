import{r as i,P as j,j as a,D as v}from"./index-BOrs9Cmb.js";import{d as Z,E as ee}from"./jspdf.plugin.autotable-BKYhmki5.js";import{u as w,w as se}from"./xlsx-CASJRvIk.js";import{R as te}from"./index-DRdFyEpo.js";import{B as u}from"./Box-DpLwRB0J.js";import{P as oe,T as ae,I}from"./IconButton-SZuj0VD6.js";import{T as ne}from"./TextField-D9XwQG_q.js";import{c as N,T as re,a as A,v as q}from"./TableSortLabel-CsDftX1q.js";import{T as ie,a as ce,e as le,c as _,d as l,b as de}from"./TableRow-BtW6bwTe.js";import"./createSvgIcon-CPmCxJRd.js";import"./DefaultLayout-CiqnaNuY.js";import"./index.esm-DYk-UL72.js";import"./cil-user-Ddrdy7PS.js";import"./dividerClasses-BjxhlnSS.js";const me=[{id:"employee_code",numeric:!1,disablePadding:!0,label:"Employee Code"},{id:"employee_name",numeric:!0,disablePadding:!1,label:"Employee Name"}];function Se(){const[g,k]=i.useState("asc"),[f,F]=i.useState("employee_code"),[d,P]=i.useState(0),[m,H]=i.useState(5),[h,B]=i.useState([]),[c,O]=i.useState(""),[x,z]=i.useState([]),[y,M]=i.useState([]);i.useEffect(()=>{(async()=>{try{const r=(await v.get("/item/getAll/")).data.filter(s=>s.item_type.item_type_id===3).map(s=>({id:s.item_name,label:s.item_name,numeric:s.numeric||!1,disablePadding:s.disablePadding||!1}));M(r),console.log("Filtered headers:",r)}catch(e){console.error("Error fetching data:",e)}})()},[]);function T(o){const{order:e,orderBy:t,onRequestSort:n}=o,r=s=>p=>{n(p,s)};return a.jsx(de,{children:a.jsxs(_,{children:[me.map(s=>a.jsx(l,{align:s.numeric?"right":"left",padding:s.disablePadding?"none":"normal",sortDirection:t===s.id?e:!1,children:a.jsxs(A,{active:t===s.id,direction:t===s.id?e:"asc",onClick:r(s.id),children:[s.label,t===s.id?a.jsx(u,{component:"span",sx:q,children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},s.id)),y.map(s=>a.jsx(l,{align:s.numeric?"right":"left",padding:s.disablePadding?"none":"normal",sortDirection:t===s.id?e:!1,children:a.jsxs(A,{active:t===s.id,direction:t===s.id?e:"asc",onClick:r(s.id),children:[s.label,t===s.id?a.jsx(u,{component:"span",sx:q,children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},s.id))]})})}T.propTypes={onRequestSort:j.func.isRequired,order:j.oneOf(["asc","desc"]).isRequired,orderBy:j.string.isRequired};function R(o,e,t){return e[t]<o[t]?-1:e[t]>o[t]?1:0}function Q(o,e){return o==="desc"?(t,n)=>R(t,n,e):(t,n)=>-R(t,n,e)}function W(o,e){const t=o.map((n,r)=>[n,r]);return t.sort((n,r)=>{const s=e(n[0],r[0]);return s!==0?s:n[1]-r[1]}),t.map(n=>n[0])}i.useEffect(()=>{(async()=>{try{const e=await v.get("/item/issued/?filter=Dress");console.log("API Response:",e.data);const t=e.data.data||[],n=[...new Set(t.flatMap(s=>s.items.map(p=>p.item_name)))];z(n);const r=t.map((s,p)=>{const C={};return n.forEach(E=>{var L;const D=(L=s.items)==null?void 0:L.find(Y=>Y.item_name===E);C[E.toLowerCase().replace(/\s+/g,"_")]=D?D.issue_date:"N/A"}),{id:p+1,employee_code:s.employee_id||"N/A",employee_name:s.employee_name||"N/A",image:s.image||"N/A",...C}});console.log("Unique Item Names:",n),console.log("Formatted Data:",r),B(r)}catch(e){e.isAxiosError&&e.response?(console.error(`HTTP error! status: ${e.response.status}`),console.error("Response body:",e.response.data),alert(`Error: ${JSON.stringify(e.response.data)}`)):console.error("Error fetching data:",e)}})()},[]);const $=(o,e)=>{k(f===e&&g==="asc"?"desc":"asc"),F(e)},J=(o,e)=>{P(e)},U=o=>{H(parseInt(o.target.value,10)),P(0)},G=()=>{const o=new ee,e=["Employee Code","Employee Name",...y.map(t=>t.label)];o.autoTable({head:[e],body:h.map(t=>[t.employee_code,t.employee_name,...x.map(n=>t[n.toLowerCase().replace(/\s+/g,"_")])])}),o.save("itemwise-ppe-reports.pdf")},K=()=>{const o=[["Employee Code","Employee Name",...y.map(n=>n.label)],...h.map(n=>[n.employee_code,n.employee_name,...x.map(r=>n[r.toLowerCase().replace(/\s+/g,"_")])])],e=w.aoa_to_sheet(o),t=w.book_new();w.book_append_sheet(t,e,"Itemwise PPE Report"),se(t,"itemwise-ppe-reports.xlsx")},V=o=>{O(o.target.value)},b=h.filter(o=>o.employee_code.toLowerCase().includes(c.toLowerCase())||o.employee_name.toLowerCase().includes(c.toLowerCase())||o.dress.toLowerCase().includes(c.toLowerCase())||o.jacket.toLowerCase().includes(c.toLowerCase())||o.reflectingjacket.toLowerCase().includes(c.toLowerCase())||o.raincoat.toLowerCase().includes(c.toLowerCase())),S=d>0?Math.max(0,(1+d)*m-b.length):0,X=W(b,Q(g,f)).slice(d*m,d*m+m);return a.jsx(u,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:a.jsxs(oe,{sx:{width:"100%",mb:2,padding:5},children:[a.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[a.jsx(ae,{variant:"h6",id:"tableTitle",component:"div",children:"Item Wise Dress Report"}),a.jsxs(u,{children:[a.jsx(ne,{variant:"outlined",size:"small",placeholder:"Search...",value:c,onChange:V,sx:{marginRight:2}}),a.jsx(N,{title:"Download PDF",children:a.jsx(I,{onClick:G,children:a.jsx(Z,{})})}),a.jsx(N,{title:"Download Excel",children:a.jsx(I,{onClick:K,children:a.jsx(te,{})})})]})]}),a.jsx(ie,{children:a.jsxs(ce,{sx:{minWidth:730},"aria-labelledby":"tableTitle",children:[a.jsx(T,{order:g,orderBy:f,onRequestSort:$}),a.jsxs(le,{children:[X.map(o=>a.jsxs(_,{hover:!0,sx:{cursor:"pointer"},children:[a.jsx(l,{component:"th",scope:"row",padding:"none",children:o.employee_code}),a.jsx(l,{align:"right",children:o.employee_name}),x.map(e=>a.jsx(l,{children:o[e.toLowerCase().replace(/\s+/g,"_")]},e))]},o.employee_code)),S>0&&a.jsx(_,{style:{height:53*S},children:a.jsx(l,{colSpan:6})})]})]})}),a.jsx(re,{rowsPerPageOptions:[5,10,25],component:"div",count:b.length,rowsPerPage:m,page:d,onPageChange:J,onRowsPerPageChange:U})]})})}export{Se as default};
