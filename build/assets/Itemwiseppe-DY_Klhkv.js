import{r as i,P as j,j as o,D as C}from"./index-BOrs9Cmb.js";import{d as ee,E as se}from"./jspdf.plugin.autotable-BKYhmki5.js";import{u as P,w as te}from"./xlsx-CASJRvIk.js";import{R as oe}from"./index-DRdFyEpo.js";import{B as p}from"./Box-DpLwRB0J.js";import{P as ae,T as ne,I as N}from"./IconButton-SZuj0VD6.js";import{T as re}from"./TextField-D9XwQG_q.js";import{c as A,T as ie,a as q,v as L}from"./TableSortLabel-CsDftX1q.js";import{T as ce,a as le,e as de,c as _,d as c,b as me}from"./TableRow-BtW6bwTe.js";import"./createSvgIcon-CPmCxJRd.js";import"./DefaultLayout-CiqnaNuY.js";import"./index.esm-DYk-UL72.js";import"./cil-user-Ddrdy7PS.js";import"./dividerClasses-BjxhlnSS.js";const F=[{id:"employee_id",numeric:!1,disablePadding:!0,label:"Employee Code"},{id:"employee_name",numeric:!0,disablePadding:!1,label:"Employee Name"}];function Re(){const[u,H]=i.useState("asc"),[g,k]=i.useState("employee_id"),[l,w]=i.useState(0),[d,B]=i.useState(5),[f,O]=i.useState([]),[h,z]=i.useState(""),[x,M]=i.useState([]),[y,Q]=i.useState([]);i.useEffect(()=>{(async()=>{try{const r=(await C.get("/item/getAll/")).data.filter(s=>s.item_type.item_type_id===2).map(s=>({id:s.item_name,label:s.item_name,numeric:s.numeric||!1,disablePadding:s.disablePadding||!1}));Q(r),console.log("Filtered headers:",r)}catch(e){console.error("Error fetching data:",e)}})()},[]);function T(a){const{order:e,orderBy:t,onRequestSort:n}=a,r=s=>m=>{n(m,s)};return o.jsx(me,{children:o.jsxs(_,{children:[F.map(s=>o.jsx(c,{align:(s.numeric,"left"),padding:s.disablePadding?"none":"normal",sortDirection:t===s.id?e:!1,children:o.jsxs(q,{active:t===s.id,direction:t===s.id?e:"asc",onClick:r(s.id),children:[s.label,t===s.id?o.jsx(p,{component:"span",sx:L,children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},s.id)),y.map(s=>o.jsx(c,{align:s.numeric?"right":"left",padding:s.disablePadding?"none":"normal",sortDirection:t===s.id?e:!1,children:o.jsxs(q,{active:t===s.id,direction:t===s.id?e:"asc",onClick:r(s.id),children:[s.label,t===s.id?o.jsx(p,{component:"span",sx:L,children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},s.id))]})})}T.propTypes={onRequestSort:j.func.isRequired,order:j.oneOf(["asc","desc"]).isRequired,orderBy:j.string.isRequired};function E(a,e,t){return e[t]<a[t]?-1:e[t]>a[t]?1:0}function W(a,e){return a==="desc"?(t,n)=>E(t,n,e):(t,n)=>-E(t,n,e)}function $(a,e){const t=a.map((n,r)=>[n,r]);return t.sort((n,r)=>{const s=e(n[0],r[0]);return s!==0?s:n[1]-r[1]}),t.map(n=>n[0])}i.useEffect(()=>{(async()=>{try{const e=await C.get("/item/issued/?filter=PPE");console.log("API Response:",e.data);const t=e.data.data||[],n=[...new Set(t.flatMap(s=>s.items.map(m=>m.item_name)))];M(n);const r=t.map((s,m)=>{const S={};return n.forEach(D=>{var I;const v=(I=s.items)==null?void 0:I.find(Z=>Z.item_name===D);S[D.toLowerCase().replace(/\s+/g,"_")]=v?v.issue_date:"N/A"}),{id:m+1,employee_code:s.employee_id||"N/A",employee_name:s.employee_name||"N/A",image:s.image||"N/A",...S}});console.log("Unique Item Names:",n),console.log("Formatted Data:",r),O(r)}catch(e){e.isAxiosError&&e.response?(console.error(`HTTP error! status: ${e.response.status}`),console.error("Response body:",e.response.data),alert(`Error: ${JSON.stringify(e.response.data)}`)):console.error("Error fetching data:",e)}})()},[]);const J=(a,e)=>{H(g===e&&u==="asc"?"desc":"asc"),k(e)},U=(a,e)=>{w(e)},G=a=>{B(parseInt(a.target.value,10)),w(0)},K=()=>{const a=new se,e=["Employee Code","Employee Name",...y.map(t=>t.label)];a.autoTable({head:[e],body:f.map(t=>[t.employee_code,t.employee_name,...x.map(n=>t[n.toLowerCase().replace(/\s+/g,"_")])])}),a.save("itemwise-ppe-reports.pdf")},V=()=>{const a=[["Employee Code","Employee Name",...y.map(n=>n.label)],...f.map(n=>[n.employee_code,n.employee_name,...x.map(r=>n[r.toLowerCase().replace(/\s+/g,"_")])])],e=P.aoa_to_sheet(a),t=P.book_new();P.book_append_sheet(t,e,"Itemwise PPE Report"),te(t,"itemwise-ppe-reports.xlsx")},X=a=>{z(a.target.value)},b=f.filter(a=>a.employee_code.toLowerCase().includes(h.toLowerCase())||a.employee_name.toLowerCase().includes(h.toLowerCase())),R=l>0?Math.max(0,(1+l)*d-b.length):0,Y=$(b,W(u,g)).slice(l*d,l*d+d);return o.jsx(p,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:o.jsxs(ae,{sx:{width:"100%",mb:2,padding:5},children:[o.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[o.jsx(ne,{variant:"h6",id:"tableTitle",component:"div",children:"Item Wise PPE Report"}),o.jsxs(p,{children:[o.jsx(re,{variant:"outlined",size:"small",placeholder:"Search...",value:h,onChange:X,sx:{marginRight:2}}),o.jsx(A,{title:"Download PDF",children:o.jsx(N,{onClick:K,children:o.jsx(ee,{})})}),o.jsx(A,{title:"Download Excel",children:o.jsx(N,{onClick:V,children:o.jsx(oe,{})})})]})]}),o.jsx(ce,{children:o.jsxs(le,{sx:{minWidth:730},"aria-labelledby":"tableTitle",children:[o.jsx(T,{order:u,orderBy:g,onRequestSort:J}),o.jsxs(de,{children:[Y.map(a=>o.jsxs(_,{hover:!0,sx:{cursor:"pointer"},children:[o.jsx(c,{component:"th",scope:"row",padding:"none",children:a.employee_code}),o.jsx(c,{align:"left",children:a.employee_name}),x.map(e=>o.jsx(c,{children:a[e.toLowerCase().replace(/\s+/g,"_")]},e))]},a.employee_code)),R>0&&o.jsx(_,{style:{height:53*R},children:o.jsx(c,{colSpan:F.length})})]})]})}),o.jsx(ie,{rowsPerPageOptions:[5,10,25],component:"div",count:b.length,rowsPerPage:d,page:l,onPageChange:U,onRowsPerPageChange:G})]})})}export{Re as default};
